{"dependencies":[{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":89,"index":89}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}},{"name":"@react-native-community/netinfo","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":90},"end":{"line":2,"column":72,"index":162}}],"key":"PqZcYTlMIVnzFjdViPzMiGUu7Hg=","exportNames":["*"],"imports":1}},{"name":"react-native-web/dist/exports/Alert","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"PEUC6jrQVoAGZ2qYkvimljMOyJI=","exportNames":["*"],"imports":1}},{"name":"react-native-web/dist/exports/Platform","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"dV3bI3NOD8bfMzaIniMaFGy/nn8=","exportNames":["*"],"imports":1}},{"name":"../utils/cacheManager","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":211},"end":{"line":4,"column":53,"index":264}}],"key":"khlnndGTcOlkIW6B06Jlcfzuf30=","exportNames":["*"],"imports":1}},{"name":"axios","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":5,"column":0,"index":265},"end":{"line":5,"column":26,"index":291}}],"key":"e45rENb5cSu0Yeh6oC1uWb7lEp4=","exportNames":["*"],"imports":1}},{"name":"react/jsx-runtime","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"3suYSPX9nHbHZ1xNTsKXtKj0atE=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function(g,r,i,a,m,_e,d){\"use strict\";function e(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(_e,'__esModule',{value:!0}),Object.defineProperty(_e,\"OfflineProvider\",{enumerable:!0,get:function(){return l}}),Object.defineProperty(_e,\"useOffline\",{enumerable:!0,get:function(){return f}});var n=r(d[0]),t=(e(r(d[1])),e(r(d[2])));r(d[3]);var o=r(d[4]),s=e(r(d[5])),c=r(d[6]);const u=(0,n.createContext)(void 0),l=({children:e})=>{const[l,f]=(0,n.useState)(!0),[p,h]=(0,n.useState)(!1),[z,w]=(0,n.useState)(!1),[y,O]=(0,n.useState)(null),[S,$]=(0,n.useState)(0);(0,n.useEffect)(()=>(console.log('\\ud83c\\udf10 Running on web, assuming online'),f(!0),v(),void P()),[]);const v=async()=>{const e=await o.cacheManager.getLastSyncTimestamp();O(e)},P=async()=>{const e=await o.cacheManager.getOfflineQueue();$(e.length)},M=async()=>{if(!z&&l&&!p){w(!0);try{const e=await o.cacheManager.getOfflineQueue();console.log(`\\ud83d\\udd04 Syncing ${e.length} offline operations...`);let n=0,c=0;for(const t of e)try{if(t.retries>=3){console.warn(`\\u26a0\\ufe0f Item ${t.id} exceeded max retries, skipping`),await o.cacheManager.removeFromOfflineQueue(t.id),c++;continue}const e=\"https://foodcoach-android.preview.emergentagent.com\",u=await(0,s.default)({method:t.method,url:`${e}${t.endpoint}`,data:t.data,timeout:1e4});if(!(u.status>=200&&u.status<300))throw new Error(`HTTP ${u.status}`);await o.cacheManager.removeFromOfflineQueue(t.id),n++,console.log(`\\u2705 Synced: ${t.method} ${t.endpoint}`)}catch(e){console.error(`\\u274c Sync failed for ${t.id}:`,e.message),await o.cacheManager.incrementRetryCount(t.id),c++,await new Promise(e=>setTimeout(e,1e3*t.retries))}await o.cacheManager.setLastSyncTimestamp(),O(Date.now()),await P(),n>0?t.default.alert('\\u2705 Dati Sincronizzati',`${n} operazione${n>1?'i':''} sincronizzata${n>1?'e':''} con successo!${c>0?`\\n${c} operazione${c>1?'i':''} fallita${c>1?'e':''}.`:''}`):c>0&&t.default.alert('\\u26a0\\ufe0f Sincronizzazione Parziale',\"Alcune operazioni non sono state sincronizzate. Riproveremo automaticamente.\")}catch(e){console.error('Sync error:',e),t.default.alert('\\u274c Errore Sincronizzazione','Impossibile sincronizzare i dati. Riproveremo quando torni online.')}finally{w(!1)}}},b={isOnline:l&&!p,isForceOffline:p,setForceOffline:e=>{h(e),e&&t.default.alert('\\ud83d\\udce1 Modalit\\xe0 Offline Forzata','L\\'app funzioner\\xe0 offline anche se connesso a internet. Puoi disabilitare questa opzione in Impostazioni.')},syncPending:z,lastSyncTime:y,queueLength:S,syncData:M};return(0,c.jsx)(u.Provider,{value:b,children:e})},f=()=>{const e=(0,n.useContext)(u);if(!e)throw new Error('useOffline must be used within OfflineProvider');return e}});","lineCount":1,"map":[[1,143,19,0,"Object"],[1,150,19,0,"defineProperty"],[1,165,19,0,"_e"],[1,168,19,0],[1,187,19,0,"enumerable"],[1,199,19,0],[1,201,19,0,"get"],[1,205,19,0],[1,223,19,0,"OfflineProvider"],[1,224,19,0],[1,228,191,0,"Object"],[1,235,191,0,"defineProperty"],[1,250,191,0,"_e"],[1,253,191,0],[1,267,191,0,"enumerable"],[1,279,191,0],[1,281,191,0,"get"],[1,285,191,0],[1,303,191,0,"useOffline"],[1,304,191,0],[1,308,1,0],[1,312,1,0,"_react"],[1,314,1,0,"r"],[1,316,1,0,"d"],[1,318,1,0],[1,322,2,72,"Alert"],[1,325,2,0,"_interopDefault"],[1,327,2,0,"r"],[1,329,2,0,"d"],[1,331,2,0],[1,336,2,72,"_interopDefault"],[1,338,2,72,"r"],[1,340,2,72,"d"],[1,342,2,72],[1,348,2,72,"r"],[1,350,2,72,"d"],[1,352,2,72],[1,356,4,0],[1,360,4,0,"_utilsCacheManager"],[1,362,4,0,"r"],[1,364,4,0,"d"],[1,366,4,0],[1,370,5,0,"axios"],[1,372,5,0,"_interopDefault"],[1,374,5,0,"r"],[1,376,5,0,"d"],[1,378,5,0],[1,383,5,26,"_reactJsxRuntime"],[1,385,5,26,"r"],[1,387,5,26,"d"],[1,389,5,26],[1,393,17,0],[1,399,17,6,"OfflineContext"],[1,402,17,23],[1,404,17,23,"createContext"],[1,406,17,36,"createContext"],[1,426,17,69,"undefined"],[1,429,19,13,"OfflineProvider"],[1,431,19,66,"OfflineProvider"],[1,433,19,69,"children"],[1,448,20,2],[1,454,20,9,"isOnline"],[1,456,20,19,"setIsOnline"],[1,460,20,34],[1,462,20,34,"useState"],[1,464,20,42,"useState"],[1,475,20,52],[1,479,21,9,"isForceOffline"],[1,481,21,25,"setIsForceOffline"],[1,485,21,46],[1,487,21,46,"useState"],[1,489,21,54,"useState"],[1,500,21,64],[1,504,22,9,"syncPending"],[1,506,22,22,"setSyncPending"],[1,510,22,40],[1,512,22,40,"useState"],[1,514,22,48,"useState"],[1,525,22,58],[1,529,23,9,"lastSyncTime"],[1,531,23,23,"setLastSyncTime"],[1,535,23,42],[1,537,23,42,"useState"],[1,539,23,50,"useState"],[1,549,23,66],[1,556,24,9,"queueLength"],[1,558,24,22,"setQueueLength"],[1,562,24,40],[1,564,24,40,"useState"],[1,566,24,48,"useState"],[1,576,24,57],[1,580,27,2],[1,582,27,2,"useEffect"],[1,584,27,11,"useEffect"],[1,595,27,12],[1,600,30,6,"console"],[1,608,30,14,"log"],[1,612,30,18],[1,660,31,6,"setIsOnline"],[1,663,31,18],[1,666,32,6,"loadLastSyncTime"],[1,675,33,6,"updateQueueLength"],[1,680,54,5],[1,684,56,2],[1,690,62,8,"loadLastSyncTime"],[1,692,62,27,"async"],[1,702,63,4],[1,708,63,10,"timestamp"],[1,716,63,28,"cacheManager"],[1,718,63,40,"cacheManager"],[1,731,63,41,"getLastSyncTimestamp"],[1,754,64,4,"setLastSyncTime"],[1,756,64,20,"timestamp"],[1,760,67,8,"updateQueueLength"],[1,762,67,28,"async"],[1,772,68,4],[1,778,68,10,"queue"],[1,786,68,24,"cacheManager"],[1,788,68,36,"cacheManager"],[1,801,68,37,"getOfflineQueue"],[1,819,69,4,"setQueueLength"],[1,821,69,19,"queue"],[1,823,69,25,"length"],[1,832,89,8,"syncData"],[1,834,89,19,"async"],[1,844,90,4],[1,848,90,8,"syncPending"],[1,851,91,9,"isOnline"],[1,855,91,21,"isForceOffline"],[1,857,91,4],[1,858,93,4,"setSyncPending"],[1,861,93,19],[1,864,95,4],[1,868,96,6],[1,874,96,12,"queue"],[1,882,96,26,"cacheManager"],[1,884,96,38,"cacheManager"],[1,897,96,39,"getOfflineQueue"],[1,915,97,6,"console"],[1,923,97,14,"log"],[1,927,97,18],[1,951,97,32,"queue"],[1,953,97,38,"length"],[1,985,99,6],[1,989,99,10,"successCount"],[1,991,99,25],[1,993,100,10,"failCount"],[1,995,100,22],[1,997,103,6],[1,1001,103,11],[1,1007,103,17,"item"],[1,1012,103,25,"queue"],[1,1014,104,8],[1,1018,106,10],[1,1021,106,14,"item"],[1,1023,106,19,"retries"],[1,1032,106,30],[1,1034,106,33],[1,1035,107,12,"console"],[1,1043,107,20,"warn"],[1,1048,107,25],[1,1069,107,36,"item"],[1,1071,107,41,"id"],[1,1114,108,18,"cacheManager"],[1,1116,108,30,"cacheManager"],[1,1129,108,31,"removeFromOfflineQueue"],[1,1152,108,54,"item"],[1,1154,108,59,"id"],[1,1158,109,12,"failCount"],[1,1162,110,12],[1,1170,111,10],[1,1171,114,10],[1,1177,114,16,"API_URL"],[1,1179,114,23],[1,1233,115,16,"response"],[1,1241,115,33],[1,1243,115,33,"axios"],[1,1245,115,38,"default"],[1,1254,115,39],[1,1255,116,12,"method"],[1,1262,116,20,"item"],[1,1264,116,25,"method"],[1,1271,117,12,"url"],[1,1275,117,17],[1,1278,117,20,"API_URL"],[1,1282,117,30,"item"],[1,1284,117,35,"endpoint"],[1,1295,118,12,"data"],[1,1300,118,18,"item"],[1,1302,118,23,"data"],[1,1307,119,12,"timeout"],[1,1315,119,21],[1,1321,122,10],[1,1326,122,14,"response"],[1,1328,122,23,"status"],[1,1336,122,33],[1,1341,122,40,"response"],[1,1343,122,49,"status"],[1,1350,122,58],[1,1355,128,12],[1,1361,128,18],[1,1365,128,22,"Error"],[1,1371,128,28],[1,1379,128,36,"response"],[1,1381,128,45,"status"],[1,1397,124,18,"cacheManager"],[1,1399,124,30,"cacheManager"],[1,1412,124,31,"removeFromOfflineQueue"],[1,1435,124,54,"item"],[1,1437,124,59,"id"],[1,1441,125,12,"successCount"],[1,1445,126,12,"console"],[1,1453,126,20,"log"],[1,1457,126,24],[1,1475,126,37,"item"],[1,1477,126,42,"method"],[1,1487,126,52,"item"],[1,1489,126,57,"endpoint"],[1,1500,131,8],[1,1501,131,10],[1,1507,131,17,"error"],[1,1510,132,10,"console"],[1,1518,132,18,"error"],[1,1524,132,24],[1,1550,132,45,"item"],[1,1552,132,50,"id"],[1,1558,132,57,"error"],[1,1560,132,63,"message"],[1,1575,135,16,"cacheManager"],[1,1577,135,28,"cacheManager"],[1,1590,135,29,"incrementRetryCount"],[1,1610,135,49,"item"],[1,1612,135,54,"id"],[1,1616,136,10,"failCount"],[1,1626,139,16],[1,1630,139,20,"Promise"],[1,1638,139,28,"resolve"],[1,1641,139,39,"setTimeout"],[1,1652,139,50,"resolve"],[1,1654,139,59],[1,1658,139,66,"item"],[1,1660,139,71,"retries"],[1,1669,140,8],[1,1676,144,12,"cacheManager"],[1,1678,144,24,"cacheManager"],[1,1691,144,25,"setLastSyncTimestamp"],[1,1714,145,6,"setLastSyncTime"],[1,1716,145,22,"Date"],[1,1721,145,27,"now"],[1,1734,148,12,"updateQueueLength"],[1,1738,151,10,"successCount"],[1,1740,151,25],[1,1742,152,8,"Alert"],[1,1744,152,13,"default"],[1,1752,152,14,"alert"],[1,1758,153,10],[1,1786,154,10],[1,1789,154,13,"successCount"],[1,1804,154,39,"successCount"],[1,1806,154,54],[1,1808,154,58],[1,1812,154,64],[1,1831,154,83,"successCount"],[1,1833,154,98],[1,1835,154,102],[1,1839,154,108],[1,1858,154,127,"failCount"],[1,1860,154,139],[1,1862,154,143],[1,1867,154,148,"failCount"],[1,1882,154,171,"failCount"],[1,1884,154,183],[1,1886,154,187],[1,1890,154,193],[1,1903,154,206,"failCount"],[1,1905,154,218],[1,1907,154,222],[1,1911,154,228],[1,1917,154,236],[1,1923,156,17,"failCount"],[1,1925,156,29],[1,1928,157,8,"Alert"],[1,1930,157,13,"default"],[1,1938,157,14,"alert"],[1,1944,158,10],[1,1985,159,10],[1,2064,163,4],[1,2065,163,6],[1,2071,163,13,"error"],[1,2074,164,6,"console"],[1,2082,164,14,"error"],[1,2088,164,20],[1,2102,164,35,"error"],[1,2105,165,6,"Alert"],[1,2107,165,11,"default"],[1,2115,165,12,"alert"],[1,2121,166,8],[1,2154,167,8],[1,2223,169,4],[1,2224,169,5],[1,2232,170,6,"setSyncPending"],[1,2235,170,21],[1,2237,171,4],[1,2238,91,37],[1,2241,174,8,"value"],[1,2243,174,36],[1,2244,175,4,"isOnline"],[1,2253,175,14,"isOnline"],[1,2257,175,27,"isForceOffline"],[1,2259,176,4,"isForceOffline"],[1,2276,177,4,"setForceOffline"],[1,2292,79,27,"force"],[1,2296,80,4,"setIsForceOffline"],[1,2298,80,22,"force"],[1,2301,81,8,"force"],[1,2304,82,6,"Alert"],[1,2306,82,11,"default"],[1,2314,82,12,"alert"],[1,2320,83,8],[1,2363,84,8],[1,2476,178,4,"syncPending"],[1,2490,179,4,"lastSyncTime"],[1,2505,180,4,"queueLength"],[1,2519,181,4,"syncData"],[1,2531,184,2],[1,2538,185,4],[1,2540,185,4,"_reactJsxRuntime"],[1,2542,185,4,"jsx"],[1,2547,185,5,"OfflineContext"],[1,2549,185,20,"Provider"],[1,2558,185,28],[1,2559,185,29,"value"],[1,2565,185,36,"value"],[1,2567,185,42,"children"],[1,2576,186,7,"children"],[1,2581,191,13,"useOffline"],[1,2583,191,26,"useOffline"],[1,2588,192,2],[1,2594,192,8,"context"],[1,2597,192,18],[1,2599,192,18,"useContext"],[1,2601,192,28,"useContext"],[1,2613,192,29,"OfflineContext"],[1,2616,193,2],[1,2620,193,7,"context"],[1,2622,194,4],[1,2628,194,10],[1,2632,194,14,"Error"],[1,2638,194,20],[1,2688,196,2],[1,2695,196,9,"context"],[1,2697,197,2],[1,2700]],"functionMap":{"names":["<global>","OfflineProvider","useEffect$argument_0","NetInfo.addEventListener$argument_0","<anonymous>","checkInitialConnection","loadLastSyncTime","updateQueueLength","checkAndSync","setForceOffline","syncData","Promise$argument_0","useOffline"],"mappings":"AAA;kECkB;YCQ;iDCW;KDQ;WEO,mBF;GDC;iCIE;GJI;2BKE;GLG;4BME;GNG;uBOE;GPK;0BQE;GRQ;mBSE;4BCkD,mDD;GTiC;CDiB;0BYE;CZM"},"hasCjsExports":false},"type":"js/module"}]}